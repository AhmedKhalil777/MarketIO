import getOppositePlacement from"../utils/getOppositePlacement.js";import getBasePlacement from"../utils/getBasePlacement.js";import getOppositeVariationPlacement from"../utils/getOppositeVariationPlacement.js";import detectOverflow from"../utils/detectOverflow.js";import computeAutoPlacement from"../utils/computeAutoPlacement.js";import{bottom,top,start,right,left,auto}from"../enums.js";import getVariation from"../utils/getVariation.js";function getExpandedFallbackPlacements(e){if(getBasePlacement(e)===auto)return[];var t=getOppositePlacement(e);return[getOppositeVariationPlacement(e),t,getOppositeVariationPlacement(t)]}function flip(e){var t=e.state,a=e.options,o=e.name;if(!t.modifiersData[o]._skip){for(var n=a.fallbackPlacements,i=a.padding,r=a.boundary,l=a.rootBoundary,p=a.altBoundary,s=a.flipVariations,m=void 0===s||s,c=a.allowedAutoPlacements,f=t.options.placement,u=getBasePlacement(f),d=n||(u===f||!m?[getOppositePlacement(f)]:getExpandedFallbackPlacements(f)),g=[f].concat(d).reduce(function(e,a){return e.concat(getBasePlacement(a)===auto?computeAutoPlacement(t,{placement:a,boundary:r,rootBoundary:l,padding:i,flipVariations:m,allowedAutoPlacements:c}):a)},[]),P=t.rects.reference,b=t.rects.popper,v=new Map,O=!0,B=g[0],k=0;k<g.length;k++){var y=g[k],V=getBasePlacement(y),h=getVariation(y)===start,j=[top,bottom].indexOf(V)>=0,w=j?"width":"height",x=detectOverflow(t,{placement:y,boundary:r,rootBoundary:l,altBoundary:p,padding:i}),A=j?h?right:left:h?bottom:top;P[w]>b[w]&&(A=getOppositePlacement(A));var E=getOppositePlacement(A),_=[x[V]<=0,x[A]<=0,x[E]<=0];if(_.every(function(e){return e})){B=y,O=!1;break}v.set(y,_)}if(O)for(var D=function(e){var t=g.find(function(t){var a=v.get(t);if(a)return a.slice(0,e).every(function(e){return e})});if(t)return B=t,"break"},F=m?3:1;F>0;F--){if("break"===D(F))break}t.placement!==B&&(t.modifiersData[o]._skip=!0,t.placement=B,t.reset=!0)}}export default{name:"flip",enabled:!0,phase:"main",fn:flip,requiresIfExists:["offset"],data:{_skip:!1}};